function restore(){jQuery("#record, #live").removeClass("disabled");jQuery("#pause").replaceWith('<a class="button one" id="pause">Pause</a>');jQuery(".one").addClass("disabled");Fr.voice.stop();}
jQuery(document).ready(function(){Fr.voice.mp3WorkerPath="../files/2017/01/mp3Worker.txt";jQuery(document).on("click","#record:not(.disabled)",function(){elem=jQuery(this);Fr.voice.record(jQuery("#live").is(":checked"),function(){elem.addClass("disabled");jQuery("#live").addClass("disabled");jQuery(".one").removeClass("disabled");analyser=Fr.voice.context.createAnalyser();analyser.fftSize=2048;analyser.minDecibels=-90;analyser.maxDecibels=-10;analyser.smoothingTimeConstant=0.85;Fr.voice.input.connect(analyser);var bufferLength=analyser.frequencyBinCount;var dataArray=new Uint8Array(bufferLength);WIDTH=500,HEIGHT=200;canvasCtx=jQuery("#level")[0].getContext("2d");canvasCtx.clearRect(0,0,WIDTH,HEIGHT);function draw(){drawVisual=requestAnimationFrame(draw);analyser.getByteTimeDomainData(dataArray);canvasCtx.fillStyle='rgb(200, 200, 200)';canvasCtx.fillRect(0,0,WIDTH,HEIGHT);canvasCtx.lineWidth=2;canvasCtx.strokeStyle='rgb(0, 0, 0)';canvasCtx.beginPath();var sliceWidth=WIDTH*1.0/bufferLength;var x=0;for(var i=0;i<bufferLength;i++){var v=dataArray[i]/128.0;var y=v*HEIGHT/2;if(i===0){canvasCtx.moveTo(x,y);}else{canvasCtx.lineTo(x,y);}
x+=sliceWidth;}
canvasCtx.lineTo(WIDTH,HEIGHT/2);canvasCtx.stroke();};draw();});});jQuery(document).on("click","#pause:not(.disabled)",function(){if(jQuery(this).hasClass("resume")){Fr.voice.resume();jQuery(this).replaceWith('<a class="button one" id="pause">Pause</a>');}else{Fr.voice.pause();jQuery(this).replaceWith('<a class="button one resume" id="pause">Resume</a>');}});jQuery(document).on("click","#stop:not(.disabled)",function(){restore();});jQuery(document).on("click","#play:not(.disabled)",function(){Fr.voice.export(function(url){jQuery("#audio").attr("src",url);jQuery("#audio")[0].play();},"URL");restore();});jQuery(document).on("click","#download:not(.disabled)",function(){Fr.voice.export(function(url){jQuery("<a href='"+url+"' download='MyRecording.wav'></a>")[0].click();},"URL");restore();});jQuery(document).on("click","#base64:not(.disabled)",function(){Fr.voice.export(function(url){console.log("Here is the base64 URL : "+url);alert("Check the web console for the URL");jQuery("<a href='"+url+"' target='_blank'></a>")[0].click();},"base64");restore();});jQuery(document).on("click","#mp3:not(.disabled)",function(){alert("The conversion to MP3 will take some time (even 10 minutes), so please wait....");Fr.voice.export(function(url){console.log("Here is the MP3 URL : "+url);alert("Check the web console for the URL");jQuery("<a href='"+url+"' target='_blank'></a>")[0].click();},"mp3");restore();});jQuery(document).on("click","#save:not(.disabled)",function(){Fr.voice.export(function(blob){var formData=new FormData();formData.append('file',blob);jQuery.ajax({url:"upload.php",type:'POST',data:formData,contentType:false,processData:false,success:function(url){jQuery("#audio").attr("src",url);jQuery("#audio")[0].play();alert("Saved In Server. See audio element's src for URL");}});},"blob");restore();});});